<html>
    <head>
        <title>WebWork 2 : Using Checkboxes - User.java</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            WebWork 2 : Using Checkboxes - User.java
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jun 18, 2004 by <font color="#0050B2">plightbo</font>.
				    </div>

				    <div class="code"><div class="codeContent">
<pre><span class="java&#45;keyword">package</span> cash.model;&#10;&#10;<span class="java&#45;keyword">import</span> net.sf.hibernate.HibernateException;&#10;&#10;<span class="java&#45;keyword">import</span> org.apache.log4j.Logger;&#10;&#10;<span class="java&#45;keyword">import</span> java.security.GeneralSecurityException;&#10;<span class="java&#45;keyword">import</span> java.security.MessageDigest;&#10;<span class="java&#45;keyword">import</span> java.security.SecureRandom;&#10;<span class="java&#45;keyword">import</span> java.util.ArrayList;&#10;<span class="java&#45;keyword">import</span> java.util.Date;&#10;<span class="java&#45;keyword">import</span> java.util.HashSet;&#10;<span class="java&#45;keyword">import</span> java.util.Iterator;&#10;<span class="java&#45;keyword">import</span> java.util.List;&#10;<span class="java&#45;keyword">import</span> java.util.Locale;&#10;<span class="java&#45;keyword">import</span> java.util.Set;&#10;<span class="java&#45;keyword">import</span> java.util.SortedSet;&#10;<span class="java&#45;keyword">import</span> java.util.TimeZone;&#10;<span class="java&#45;keyword">import</span> java.util.TreeSet;&#10;&#10;<span class="java&#45;keyword">import</span> cash.config.ConfigManager;&#10;<span class="java&#45;keyword">import</span> cash.util.Hex;&#10;<span class="java&#45;keyword">import</span> cash.util.HibernateUtil;&#10;<span class="java&#45;keyword">import</span> cash.util.UtcDate;&#10;<span class="java&#45;keyword">import</span> cash.validator.PasswordFormatValidator;&#10;&#10;/&#42;&#42;&#10; &#42; Represents a User object.  Clients of <span class="java&#45;keyword">this</span> class should instantiate a User object with the&#10; &#42; multi&#45;arg constructor rather than using setters.&#10; &#42;&#10; &#42; &#64;author Joel Hockey&#10; &#42; &#64;version $Id: Using\040Checkboxes\040-\040User.java.html,v 1.1 2005/03/21 04:16:01 plightbo Exp $&#10; &#42; &#64;hibernate.class&#10; &#42;      table=<span class="java&#45;quote">&quot;user&quot;</span>&#10; &#42;      dynamic&#45;update=<span class="java&#45;quote">&quot;<span class="java&#45;keyword">true</span>&quot;</span>&#10; &#42;      optimistic&#45;lock=<span class="java&#45;quote">&quot;version&quot;</span>&#10; &#42;/&#10;<span class="java&#45;keyword">public</span> class User <span class="java&#45;keyword">implements</span> java.io.Serializable &#123;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;keyword">static</span>&#160;<span class="java&#45;keyword">final</span> Logger LOG = Logger.getLogger(User.class);&#10;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;keyword">static</span> MessageDigest s&#95;md5;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;keyword">static</span> SecureRandom s&#95;random;&#10;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;keyword">static</span>&#160;<span class="java&#45;keyword">final</span>&#160;<span class="java&#45;object">int</span> MAX&#95;LOGIN&#95;FAILURE&#95;COUNT = 20;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;keyword">static</span>&#160;<span class="java&#45;keyword">final</span>&#160;<span class="java&#45;object">boolean</span> RESET&#95;LOCKED&#95;OUT&#95;AFTER&#95;TIME = <span class="java&#45;keyword">true</span>;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;keyword">static</span>&#160;<span class="java&#45;keyword">final</span>&#160;<span class="java&#45;object">long</span> RESET&#95;LOCKED&#95;OUT&#95;TIME = 1 &#42; 60 &#42; 60 &#42; 1000; <span class="java&#45;comment">// 1 hour</span>&#10;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">int</span> m&#95;id;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">int</span> m&#95;version;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">String</span> m&#95;username;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">String</span> m&#95;password;&#10;    <span class="java&#45;keyword">private</span> Date m&#95;passwordChangeDate;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">String</span> m&#95;hashedPassword;&#10;    <span class="java&#45;keyword">private</span> SortedSet m&#95;passwordHistory = <span class="java&#45;keyword">new</span> TreeSet();&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">String</span> m&#95;salt;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">byte</span>&#91;&#93; m&#95;saltBytes;&#10;    <span class="java&#45;keyword">private</span> Date m&#95;createDate;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">String</span> m&#95;email;&#10;    <span class="java&#45;keyword">private</span> Locale m&#95;locale;&#10;    <span class="java&#45;keyword">private</span> TimeZone m&#95;timeZone;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">String</span> m&#95;telephone;&#10;    <span class="java&#45;keyword">private</span> Date m&#95;lastSuccessfulLogin;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">String</span> m&#95;lastSuccessfulLoginIp;&#10;    <span class="java&#45;keyword">private</span> Date m&#95;lastFailedLogin;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">String</span> m&#95;lastFailedLoginIp;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">int</span> m&#95;loginFailureCount;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">int</span> m&#95;maxLoginFailureCount = MAX&#95;LOGIN&#95;FAILURE&#95;COUNT;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">boolean</span> m&#95;resetLockedOutAfterTime = RESET&#95;LOCKED&#95;OUT&#95;AFTER&#95;TIME;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">long</span> m&#95;resetLockedOutTime = RESET&#95;LOCKED&#95;OUT&#95;TIME;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">boolean</span> m&#95;lockedOut = <span class="java&#45;keyword">false</span>;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">boolean</span> m&#95;disabled = <span class="java&#45;keyword">false</span>;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">boolean</span> m&#95;isSuperUser = <span class="java&#45;keyword">false</span>;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">boolean</span> m&#95;passwordNeverExpires = <span class="java&#45;keyword">false</span>;&#10;    <span class="java&#45;keyword">private</span> Set m&#95;privileges = <span class="java&#45;keyword">new</span> HashSet();&#10;&#10;    <span class="java&#45;keyword">static</span> &#123;&#10;        <span class="java&#45;keyword">try</span> &#123;&#10;            s&#95;md5 = MessageDigest.getInstance(<span class="java&#45;quote">&quot;MD5&quot;</span>);&#10;            s&#95;random = SecureRandom.getInstance(<span class="java&#45;quote">&quot;SHA1PRNG&quot;</span>);&#10;        &#125; <span class="java&#45;keyword">catch</span> (GeneralSecurityException gse) &#123;&#10;            <span class="java&#45;comment">// shouldn&#039;t happen</span>&#10;            LOG.error(<span class="java&#45;quote">&quot;Error creating MD5 or SHA1PRNG&quot;</span>, gse);&#10;            <span class="java&#45;keyword">throw</span>&#160;<span class="java&#45;keyword">new</span> RuntimeException(<span class="java&#45;quote">&quot;Error creating MD5 or SHA1PRNG&quot;</span>);&#10;        &#125;&#10;    &#125;&#10;&#10;    /&#42;&#42; <span class="java&#45;keyword">default</span> constructor <span class="java&#45;keyword">for</span> Hibernate &#42;/&#10;    <span class="java&#45;keyword">public</span> User() &#123; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; Create a User.&#10;     &#42;&#10;     &#42; &#64;param username The username <span class="java&#45;keyword">for</span> logging in&#10;     &#42; &#64;param password The user&#039;s password&#10;     &#42; &#64;param email The user&#039;s email&#10;     &#42; &#64;<span class="java&#45;keyword">throws</span> InvalidPasswordException <span class="java&#45;keyword">if</span> password is invalid.&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> User(<span class="java&#45;object">String</span> username, <span class="java&#45;object">String</span> password, <span class="java&#45;object">String</span> email) <span class="java&#45;keyword">throws</span> InvalidPasswordException &#123;&#10;&#10;        m&#95;username = username;&#10;&#10;        <span class="java&#45;comment">// password</span>&#10;        initSalt();&#10;        <span class="java&#45;keyword">if</span> (&#33;PasswordFormatValidator.checkPasswordFormat(password)) &#123;&#10;            <span class="java&#45;keyword">throw</span>&#160;<span class="java&#45;keyword">new</span> InvalidPasswordException();&#10;        &#125;&#10;        m&#95;hashedPassword = hashPassword(password);&#10;&#10;        m&#95;createDate = UtcDate.createUtcDate();&#10;        m&#95;email = email;&#10;        m&#95;locale = Locale.getDefault();&#10;        m&#95;timeZone = TimeZone.getDefault();&#10;    &#125;&#10;&#10;    /&#42;&#42; &#64;param id The id to set &#42;/&#10;    <span class="java&#45;keyword">public</span> void setId(<span class="java&#45;object">int</span> id) &#123; m&#95;id = id; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> unique id of <span class="java&#45;keyword">this</span> User.  Generated by DB.&#10;     &#42; &#64;hibernate.id&#10;     &#42;      generator&#45;class=<span class="java&#45;quote">&quot;<span class="java&#45;keyword">native</span>&quot;</span>&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">int</span> getId() &#123; <span class="java&#45;keyword">return</span> m&#95;id; &#125;&#10;&#10;    /&#42;&#42; &#64;param version The version of <span class="java&#45;keyword">this</span> object &#42;/&#10;    <span class="java&#45;keyword">public</span> void setVersion(<span class="java&#45;object">int</span> version) &#123; m&#95;version = version; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> version of <span class="java&#45;keyword">this</span> object&#10;     &#42; &#64;hibernate.version&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">int</span> getVersion() &#123; <span class="java&#45;keyword">return</span> m&#95;version; &#125;&#10;&#10;    /&#42;&#42; &#64;param username The username to set &#42;/&#10;    <span class="java&#45;keyword">public</span> void setUsername(<span class="java&#45;object">String</span> username) &#123; m&#95;username = username; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> username&#10;     &#42; &#64;hibernate.property&#10;     &#42;      length=<span class="java&#45;quote">&quot;32&quot;</span>&#10;     &#42;      unique=<span class="java&#45;quote">&quot;<span class="java&#45;keyword">true</span>&quot;</span>&#10;     &#42;      not&#45;<span class="java&#45;keyword">null</span>=<span class="java&#45;quote">&quot;<span class="java&#45;keyword">true</span>&quot;</span>&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span> getUsername() &#123; <span class="java&#45;keyword">return</span> m&#95;username; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; Set&#039;s the user&#039;s password without updating history or checking validity.&#10;     &#42; This should only be used at User creation time, and password validity&#10;     &#42; should be checked externally to <span class="java&#45;keyword">this</span> method.&#10;     &#42; Do not use to update password, see &#123;&#64;link #changePassword(<span class="java&#45;object">String</span>)&#125;&#10;     &#42; &#64;param password user&#039;s password&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> void setPassword(<span class="java&#45;object">String</span> password) &#123;&#10;        m&#95;password = password;&#10;        <span class="java&#45;keyword">if</span> (m&#95;salt == <span class="java&#45;keyword">null</span>) &#123;&#10;            initSalt();&#10;        &#125;&#10;        m&#95;hashedPassword = hashPassword(password);&#10;        m&#95;passwordChangeDate = UtcDate.createUtcDate();&#10;    &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; This method is provided to help at User creation time.  It will only <span class="java&#45;keyword">return</span>&#10;     &#42; valid values <span class="java&#45;keyword">if</span> &#123;&#64;link #setPassword(<span class="java&#45;object">String</span>)&#125; has already been called.&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> plaintext password.&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span> getPassword() &#123; <span class="java&#45;keyword">return</span> m&#95;password; &#125;&#10;&#10;    /&#42;&#42; &#64;param time Date (UTC) user last changed password. &#42;/&#10;    <span class="java&#45;keyword">public</span> void setPasswordChangeDate(Date time) &#123; m&#95;passwordChangeDate = time; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> UTC date of last password change&#10;     &#42; &#64;hibernate.property&#10;     &#42;      type=<span class="java&#45;quote">&quot;cash.model.TimestampType&quot;</span>&#10;     &#42;      length=<span class="java&#45;quote">&quot;23&quot;</span>&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> Date getPasswordChangeDate() &#123; <span class="java&#45;keyword">return</span> m&#95;passwordChangeDate; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; Sets the user&#039;s hashed password.  This method is provided only <span class="java&#45;keyword">for</span> the use&#10;     &#42; of hibernate.  Users of <span class="java&#45;keyword">this</span> class should not call <span class="java&#45;keyword">this</span> method.&#10;     &#42; Use the &#123;&#64;link #setPassword(<span class="java&#45;object">String</span>)&#125; method to set the plaintext password.&#10;     &#42; &#64;param hash The hashed password to set&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> void setHashedPassword(<span class="java&#45;object">String</span> hash) &#123;&#10;        m&#95;hashedPassword = hash;&#10;    &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> hashed password&#10;     &#42; &#64;hibernate.property&#10;     &#42;      column=<span class="java&#45;quote">&quot;pwd&quot;</span>&#10;     &#42;      length=<span class="java&#45;quote">&quot;32&quot;</span>&#10;     &#42;      not&#45;<span class="java&#45;keyword">null</span>=<span class="java&#45;quote">&quot;<span class="java&#45;keyword">true</span>&quot;</span>&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span> getHashedPassword() &#123; <span class="java&#45;keyword">return</span> m&#95;hashedPassword; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;param oldPasswords The last n passwords, where n&#10;     &#42; is defined as noRepeatHistory in User configuration.  Passwords are ordered&#10;     &#42; in descending order of creation.&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> void setPasswordHistory(SortedSet oldPasswords) &#123; m&#95;passwordHistory = oldPasswords; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> Password history&#10;     &#42; &#64;hibernate.set&#10;     &#42;      lazy=<span class="java&#45;quote">&quot;<span class="java&#45;keyword">true</span>&quot;</span>&#10;     &#42;      sort=<span class="java&#45;quote">&quot;cash.model.PasswordHistory&quot;</span>&#10;     &#42;      inverse=<span class="java&#45;quote">&quot;<span class="java&#45;keyword">true</span>&quot;</span>&#10;     &#42;      cascade=<span class="java&#45;quote">&quot;all&quot;</span>&#10;     &#42; &#64;hibernate.collection&#45;key&#10;     &#42;      column=<span class="java&#45;quote">&quot;userId&quot;</span>&#10;     &#42; &#64;hibernate.collection&#45;one&#45;to&#45;many&#10;     &#42;      class=<span class="java&#45;quote">&quot;cash.model.PasswordHistory&quot;</span>&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> SortedSet getPasswordHistory() &#123; <span class="java&#45;keyword">return</span> m&#95;passwordHistory; &#125;&#10;&#10;    /&#42;&#42; &#64;param random The random salt to be used with password &#42;/&#10;    <span class="java&#45;keyword">public</span> void setSalt(<span class="java&#45;object">String</span> random) &#123;&#10;        m&#95;salt = random;&#10;        m&#95;saltBytes = Hex.fromString(random);&#10;    &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> random salt used with password&#10;     &#42; &#64;hibernate.property&#10;     &#42;      length=<span class="java&#45;quote">&quot;32&quot;</span>&#10;     &#42;      not&#45;<span class="java&#45;keyword">null</span>=<span class="java&#45;quote">&quot;<span class="java&#45;keyword">true</span>&quot;</span>&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span> getSalt() &#123; <span class="java&#45;keyword">return</span> m&#95;salt; &#125;&#10;&#10;    /&#42;&#42; &#64;param time create date &#42;/&#10;    <span class="java&#45;keyword">public</span> void setCreateDate(Date time) &#123; m&#95;createDate = time; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> Date in UTC user was created.&#10;     &#42; &#64;hibernate.property&#10;     &#42;      update=<span class="java&#45;quote">&quot;<span class="java&#45;keyword">false</span>&quot;</span>&#10;     &#42;      not&#45;<span class="java&#45;keyword">null</span>=<span class="java&#45;quote">&quot;<span class="java&#45;keyword">true</span>&quot;</span>&#10;     &#42;      type=<span class="java&#45;quote">&quot;cash.model.TimestampType&quot;</span>&#10;     &#42;      length=<span class="java&#45;quote">&quot;23&quot;</span>&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> Date getCreateDate() &#123; <span class="java&#45;keyword">return</span> m&#95;createDate; &#125;&#10;&#10;    /&#42;&#42; &#64;param email User&#039;s email &#42;/&#10;    <span class="java&#45;keyword">public</span> void setEmail(<span class="java&#45;object">String</span> email) &#123; m&#95;email = email; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> User&#039;s email&#10;     &#42; &#64;hibernate.property&#10;     &#42;      length=<span class="java&#45;quote">&quot;255&quot;</span>&#10;     &#42;      not&#45;<span class="java&#45;keyword">null</span>=<span class="java&#45;quote">&quot;<span class="java&#45;keyword">true</span>&quot;</span>&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span> getEmail() &#123; <span class="java&#45;keyword">return</span> m&#95;email; &#125;&#10;&#10;    /&#42;&#42; &#64;param locale The User&#039;s locale.  This should be a 2 character field. &#42;/&#10;    <span class="java&#45;keyword">public</span> void setLocale(Locale locale) &#123; m&#95;locale = locale; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> User&#039;s locale.  Uses 2 character ISO&#45;something value.&#10;     &#42; &#64;hibernate.property&#10;     &#42;      not&#45;<span class="java&#45;keyword">null</span>=<span class="java&#45;quote">&quot;<span class="java&#45;keyword">true</span>&quot;</span>&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> Locale getLocale() &#123; <span class="java&#45;keyword">return</span> m&#95;locale; &#125;&#10;&#10;    /&#42;&#42; &#64;param timeZone User&#039;s time zone &#42;/&#10;    <span class="java&#45;keyword">public</span> void setTimeZone(TimeZone timeZone) &#123; m&#95;timeZone = timeZone; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> User&#039;s timezone&#10;     &#42; &#64;hibernate.property&#10;     &#42;      not&#45;<span class="java&#45;keyword">null</span>=<span class="java&#45;quote">&quot;<span class="java&#45;keyword">true</span>&quot;</span>&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> TimeZone getTimeZone() &#123; <span class="java&#45;keyword">return</span> m&#95;timeZone; &#125;&#10;&#10;    /&#42;&#42; &#64;param telephone User&#039;s telephone &#42;/&#10;    <span class="java&#45;keyword">public</span> void setTelephone(<span class="java&#45;object">String</span> telephone) &#123; m&#95;telephone = telephone; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> Telephone of user&#10;     &#42; &#64;hibernate.property&#10;     &#42;      length=<span class="java&#45;quote">&quot;16&quot;</span>&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span> getTelephone() &#123; <span class="java&#45;keyword">return</span> m&#95;telephone; &#125;&#10;&#10;    /&#42;&#42; &#64;param time user&#039;s last successful login date in UTC. &#42;/&#10;    <span class="java&#45;keyword">public</span> void setLastSuccessfulLogin(Date time) &#123; m&#95;lastSuccessfulLogin = time; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> UTC date of last successful login&#10;     &#42; &#64;hibernate.property&#10;     &#42;      type=<span class="java&#45;quote">&quot;cash.model.TimestampType&quot;</span>&#10;     &#42;      length=<span class="java&#45;quote">&quot;23&quot;</span>&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> Date getLastSuccessfulLogin() &#123; <span class="java&#45;keyword">return</span> m&#95;lastSuccessfulLogin; &#125;&#10;&#10;    /&#42;&#42; &#64;param ip IP address used <span class="java&#45;keyword">for</span> user&#039;s last successful login. &#42;/&#10;    <span class="java&#45;keyword">public</span> void setLastSuccessfulLoginIp(<span class="java&#45;object">String</span> ip) &#123; m&#95;lastSuccessfulLoginIp = ip; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> IP address used <span class="java&#45;keyword">for</span> last successful login&#10;     &#42; &#64;hibernate.property&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span> getLastSuccessfulLoginIp() &#123; <span class="java&#45;keyword">return</span> m&#95;lastSuccessfulLoginIp; &#125;&#10;&#10;    /&#42;&#42; &#64;param time user&#039;s last failed login date in UTC. &#42;/&#10;    <span class="java&#45;keyword">public</span> void setLastFailedLogin(Date time) &#123; m&#95;lastFailedLogin = time; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> UTC date of last failed login&#10;     &#42; &#64;hibernate.property&#10;     &#42;      type=<span class="java&#45;quote">&quot;cash.model.TimestampType&quot;</span>&#10;     &#42;      length=<span class="java&#45;quote">&quot;23&quot;</span>&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> Date getLastFailedLogin() &#123; <span class="java&#45;keyword">return</span> m&#95;lastFailedLogin; &#125;&#10;&#10;    /&#42;&#42; &#64;param ip IP address used <span class="java&#45;keyword">for</span> user&#039;s last failed login. &#42;/&#10;    <span class="java&#45;keyword">public</span> void setLastFailedLoginIp(<span class="java&#45;object">String</span> ip) &#123; m&#95;lastFailedLoginIp = ip; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> IP address used <span class="java&#45;keyword">for</span> last failed login&#10;     &#42; &#64;hibernate.property&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span> getLastFailedLoginIp() &#123; <span class="java&#45;keyword">return</span> m&#95;lastFailedLoginIp; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; Sets the number of times that a user has failed when attempting to login.&#10;     &#42; This value is reset when a user logs in successfully, or their account is reset.&#10;     &#42; &#64;param count the value to set.&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> void setLoginFailureCount(<span class="java&#45;object">int</span> count) &#123; m&#95;loginFailureCount = count; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> The number of times that a user has failed when attempting to login.&#10;     &#42;  This value is reset when a user logs on successfully, or their account is reset.&#10;     &#42; &#64;hibernate.property&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">int</span> getLoginFailureCount() &#123; <span class="java&#45;keyword">return</span> m&#95;loginFailureCount; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;param count The maximum number of times that a user may fail to login before&#10;     &#42; their account is locked out&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> void setMaxLoginFailureCount(<span class="java&#45;object">int</span> count) &#123; m&#95;maxLoginFailureCount = count; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> The maximum number of times that a user may fail to login before their account&#10;     &#42; is locked out.&#10;     &#42; &#64;hibernate.property&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">int</span> getMaxLoginFailureCount() &#123; <span class="java&#45;keyword">return</span> m&#95;maxLoginFailureCount; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;param reset Whether <span class="java&#45;keyword">this</span> user&#039;s account will be unlocked after a specified time when it is locked&#10;     &#42; due to login failure.&#10;     &#42; &#64;see #setResetLockedOutAfterTime(<span class="java&#45;object">boolean</span>) setResetLockedOutAfterTime&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> void setResetLockedOutAfterTime(<span class="java&#45;object">boolean</span> reset) &#123; m&#95;resetLockedOutAfterTime = reset; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> Whether <span class="java&#45;keyword">this</span> user&#039;s account will be unlocked after a specified time when it&#10;     &#42; is locked out due to login failure.&#10;     &#42; &#64;see #getResetLockedOutAfterTime getResetLockedOutAfterTime&#10;     &#42; &#64;hibernate.property&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">boolean</span> getResetLockedOutAfterTime() &#123; <span class="java&#45;keyword">return</span> m&#95;resetLockedOutAfterTime; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;param time The time in millis between login attempts before login failure count is reset.  Login failure&#10;     &#42; count will only be reset <span class="java&#45;keyword">if</span> the Reset Locked Out After Time <span class="java&#45;object">boolean</span> is set to <span class="java&#45;keyword">true</span>.&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> void setResetLockedOutTime(<span class="java&#45;object">long</span> time) &#123; m&#95;resetLockedOutTime = time; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> Time in milliseconds before account is auto&#45;reset after login lockout.&#10;     &#42; &#64;hibernate.property&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">long</span> getResetLockedOutTime() &#123; <span class="java&#45;keyword">return</span> m&#95;resetLockedOutTime; &#125;&#10;&#10;    /&#42;&#42; &#64;param lockedOut User&#039;s locked out status. &#42;/&#10;    <span class="java&#45;keyword">public</span> void setLockedOut(<span class="java&#45;object">boolean</span> lockedOut) &#123; m&#95;lockedOut = lockedOut; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> Whether <span class="java&#45;keyword">this</span> user&#039;s account is locked out&#10;     &#42; &#64;hibernate.property&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">boolean</span> isLockedOut() &#123; <span class="java&#45;keyword">return</span> m&#95;lockedOut; &#125;&#10;&#10;    /&#42;&#42; &#64;param disabled User&#039;s disabled status. &#42;/&#10;    <span class="java&#45;keyword">public</span> void setDisabled(<span class="java&#45;object">boolean</span> disabled) &#123; m&#95;disabled = disabled; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> Whether <span class="java&#45;keyword">this</span> user&#039;s account disabled&#10;     &#42; &#64;hibernate.property&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">boolean</span> isDisabled() &#123; <span class="java&#45;keyword">return</span> m&#95;disabled; &#125;&#10;&#10;    /&#42;&#42; &#64;param superUser True <span class="java&#45;keyword">if</span> user is <span class="java&#45;keyword">super</span> user &#42;/&#10;    <span class="java&#45;keyword">public</span> void setSuperUser(<span class="java&#45;object">boolean</span> superUser) &#123; m&#95;isSuperUser = superUser; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> Whether <span class="java&#45;keyword">this</span> user is a <span class="java&#45;keyword">super</span> user&#10;     &#42; &#64;hibernate.property&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">boolean</span> isSuperUser() &#123; <span class="java&#45;keyword">return</span> m&#95;isSuperUser; &#125;&#10;&#10;    /&#42;&#42; &#64;param expires True <span class="java&#45;keyword">if</span> user&#039;s password never expires &#42;/&#10;    <span class="java&#45;keyword">public</span> void setPasswordNeverExpires(<span class="java&#45;object">boolean</span> expires) &#123; m&#95;passwordNeverExpires = expires; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> Whether <span class="java&#45;keyword">this</span> user&#039;s password ever expires&#10;     &#42; &#64;hibernate.property&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">boolean</span> getPasswordNeverExpires() &#123; <span class="java&#45;keyword">return</span> m&#95;passwordNeverExpires; &#125;&#10;&#10;    /&#42;&#42; &#64;param privs Set of privileges <span class="java&#45;keyword">for</span>&#160;<span class="java&#45;keyword">this</span> user  &#42;/&#10;    <span class="java&#45;keyword">public</span> void setPrivileges(Set privs) &#123; m&#95;privileges = privs; &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> Set of Privileges <span class="java&#45;keyword">for</span>&#160;<span class="java&#45;keyword">this</span> User.&#10;     &#42; &#64;hibernate.set&#10;     &#42;      table=<span class="java&#45;quote">&quot;user&#95;priv&quot;</span>&#10;     &#42;      lazy=<span class="java&#45;quote">&quot;<span class="java&#45;keyword">true</span>&quot;</span>&#10;     &#42;      cascade=<span class="java&#45;quote">&quot;all&quot;</span>&#10;     &#42; &#64;hibernate.collection&#45;key&#10;     &#42;      column=<span class="java&#45;quote">&quot;userId&quot;</span>&#10;     &#42; &#64;hibernate.collection&#45;element&#10;     &#42;      column=<span class="java&#45;quote">&quot;priv&quot;</span>&#10;     &#42;      type=<span class="java&#45;quote">&quot;string&quot;</span>&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> Set getPrivileges() &#123; <span class="java&#45;keyword">return</span> m&#95;privileges; &#125;&#10;&#10;    /&#42;&#42; convenience method of OGNL &#42;/&#10;    <span class="java&#45;keyword">public</span> void setPriv(<span class="java&#45;object">String</span>&#91;&#93; privs) &#123;&#10;        <span class="java&#45;keyword">for</span> (<span class="java&#45;object">int</span> i = 0; i &lt; privs.length; i&#43;&#43;) &#123;&#10;            m&#95;privileges.add(privs&#91;i&#93;);&#10;        &#125;&#10;    &#125;&#10;&#10;&#10;<span class="java&#45;comment">// other methods</span>&#10;&#10;    /&#42;&#42;&#10;     &#42; Changes the user&#039;s password.  Password must meet criteria&#10;     &#42; defined in configuration.  The user&#039;s password will be appended to&#10;     &#42; a random 20 <span class="java&#45;object">byte</span> salt and then hashed using MD5 to create the&#10;     &#42; value that will be stored in the DB.  The current Hibernate Session&#10;     &#42; will be used to update pwd history.&#10;     &#42;&#10;     &#42; &#64;param password The password to set&#10;     &#42; &#64;<span class="java&#45;keyword">return</span>&#160;<span class="java&#45;keyword">true</span>&#160;<span class="java&#45;keyword">if</span> password is changed, <span class="java&#45;keyword">false</span>&#160;<span class="java&#45;keyword">if</span> password was not changed&#10;     &#42; because it did not meet password requirements.&#10;     &#42; &#64;<span class="java&#45;keyword">throws</span> HibernateException <span class="java&#45;keyword">if</span> error updating password history&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">boolean</span> changePassword(<span class="java&#45;object">String</span> password) <span class="java&#45;keyword">throws</span> HibernateException &#123;&#10;        <span class="java&#45;comment">// check format</span>&#10;        <span class="java&#45;keyword">if</span> (&#33;PasswordFormatValidator.checkPasswordFormat(password)) &#123;&#10;            <span class="java&#45;keyword">return</span>&#160;<span class="java&#45;keyword">false</span>;&#10;        &#125;&#10;&#10;        <span class="java&#45;comment">// check history</span>&#10;        <span class="java&#45;comment">// first check current password</span>&#10;        <span class="java&#45;object">String</span> hashedPwd = hashPassword(password);&#10;        LOG.debug(<span class="java&#45;quote">&quot;checking <span class="java&#45;keyword">if</span> password is same as current&quot;</span>);&#10;        <span class="java&#45;keyword">if</span> (hashedPwd.equals(m&#95;hashedPassword)) &#123;&#10;            LOG.info(<span class="java&#45;quote">&quot;password is same as current password&quot;</span>);&#10;            <span class="java&#45;keyword">return</span>&#160;<span class="java&#45;keyword">false</span>;&#10;        &#125;&#10;&#10;        LOG.debug(<span class="java&#45;quote">&quot;checking <span class="java&#45;keyword">if</span> password exists in history.  History size is &quot;</span> &#43; m&#95;passwordHistory.size());&#10;        <span class="java&#45;keyword">for</span> (Iterator i = getPasswordHistory().iterator(); i.hasNext(); ) &#123;&#10;            PasswordHistory ph = (PasswordHistory)i.next();&#10;            <span class="java&#45;keyword">if</span> (hashedPwd.equals(ph.getHashedPassword())) &#123;&#10;                LOG.info(<span class="java&#45;quote">&quot;password already used as one of last &quot;</span>&#10;                    &#43; ConfigManager.getConfig().getUser().getNoRepeatHistory());&#10;                <span class="java&#45;keyword">return</span>&#160;<span class="java&#45;keyword">false</span>;&#10;            &#125;&#10;        &#125;&#10;&#10;        <span class="java&#45;comment">// add current pwd to history and truncate history <span class="java&#45;keyword">if</span> it is too <span class="java&#45;object">long</span> now</span>&#10;        PasswordHistory ph = <span class="java&#45;keyword">new</span> PasswordHistory(<span class="java&#45;keyword">this</span>, m&#95;hashedPassword);&#10;        m&#95;passwordHistory.add(ph);&#10;        LOG.debug(<span class="java&#45;quote">&quot;saving old password into password history&quot;</span>);&#10;        HibernateUtil.currentSession().save(ph);&#10;        <span class="java&#45;comment">// compare to (noRepeat &#45; 1) because we are checking current as part of history</span>&#10;        <span class="java&#45;keyword">if</span> (m&#95;passwordHistory.size() &gt; ConfigManager.getConfig().getUser().getNoRepeatHistory() &#45; 1) &#123;&#10;            PasswordHistory toRemove = (PasswordHistory)m&#95;passwordHistory.first();&#10;            LOG.info(<span class="java&#45;quote">&quot;Removing password history object <span class="java&#45;keyword">for</span> user &quot;</span> &#43; m&#95;username&#10;                    &#43; <span class="java&#45;quote">&quot; created: &quot;</span> &#43; toRemove.getCreateDate());&#10;            m&#95;passwordHistory.remove(toRemove);&#10;            HibernateUtil.currentSession().delete(toRemove);&#10;        &#125;&#10;&#10;        <span class="java&#45;comment">// now set password and date</span>&#10;        m&#95;hashedPassword = hashedPwd;&#10;        m&#95;passwordChangeDate = UtcDate.createUtcDate();&#10;        <span class="java&#45;keyword">return</span>&#160;<span class="java&#45;keyword">true</span>;&#10;    &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; Hashes input pwd to see <span class="java&#45;keyword">if</span> it equals stored pwd hash value.&#10;     &#42; &#64;param pwd Password to check&#10;     &#42; &#64;<span class="java&#45;keyword">return</span>&#160;<span class="java&#45;keyword">true</span>&#160;<span class="java&#45;keyword">if</span> passwords are equal.&#10;     &#42;/&#10;&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">boolean</span> passwordEquals(<span class="java&#45;object">String</span> pwd) &#123;&#10;        <span class="java&#45;object">String</span> hash = hashPassword(pwd);&#10;        <span class="java&#45;keyword">return</span> m&#95;hashedPassword.equalsIgnoreCase(hash);&#10;    &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; Hashes salt and password to produce hashed password.&#10;     &#42; &#64;param pwd Password to hash&#10;     &#42; &#64;<span class="java&#45;keyword">return</span> Hex encoding of MD5 hash of salt and pwd&#10;     &#42;/&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">String</span> hashPassword(<span class="java&#45;object">String</span> pwd) &#123;&#10;        <span class="java&#45;object">byte</span>&#91;&#93; pwdBytes = pwd.getBytes();  <span class="java&#45;comment">//TODO:  should an encoding be specified here&#63;</span>&#10;        <span class="java&#45;object">byte</span>&#91;&#93; in = <span class="java&#45;keyword">new</span>&#160;<span class="java&#45;object">byte</span>&#91;OS:m&#95;saltBytes.length &#43; pwdBytes.length&#93;;&#10;        <span class="java&#45;object">System</span>.arraycopy(m&#95;saltBytes, 0, in, 0, m&#95;saltBytes.length);&#10;        <span class="java&#45;object">System</span>.arraycopy(pwdBytes, 0, in, m&#95;saltBytes.length, pwdBytes.length);&#10;        <span class="java&#45;object">byte</span>&#91;&#93; out = s&#95;md5.digest(in);&#10;        <span class="java&#45;keyword">return</span> Hex.toString(out);&#10;    &#125;&#10;&#10;    /&#42;&#42; initialises salt &#42;/&#10;    <span class="java&#45;keyword">private</span> void initSalt() &#123;&#10;        m&#95;saltBytes = <span class="java&#45;keyword">new</span>&#160;<span class="java&#45;object">byte</span>&#91;OS:16&#93;;&#10;        s&#95;random.nextBytes(m&#95;saltBytes);&#10;        m&#95;salt = Hex.toString(m&#95;saltBytes);&#10;    &#125;&#10;&#10;    /&#42;&#42; &#64;<span class="java&#45;keyword">return</span>&#160;<span class="java&#45;object">String</span> representation of User &#42;/&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span> toString() &#123;&#10;        <span class="java&#45;object">StringBuffer</span> sb = <span class="java&#45;keyword">new</span>&#160;<span class="java&#45;object">StringBuffer</span>(500);&#10;        sb.append(<span class="java&#45;quote">&quot;&#91;&quot;</span>).append(<span class="java&#45;quote">&quot;ID:&quot;</span>).append(m&#95;id)&#10;        .append(<span class="java&#45;quote">&quot;,version:&quot;</span>).append(m&#95;version)&#10;        .append(<span class="java&#45;quote">&quot;,hashedPassword:&quot;</span>).append(m&#95;hashedPassword)&#10;        .append(<span class="java&#45;quote">&quot;,salt:&quot;</span>).append(m&#95;salt)&#10;        .append(<span class="java&#45;quote">&quot;,createDate:&quot;</span>).append(m&#95;createDate)&#10;        .append(<span class="java&#45;quote">&quot;,email:&quot;</span>).append(m&#95;email)&#10;        .append(<span class="java&#45;quote">&quot;,locale:&quot;</span>).append(m&#95;locale)&#10;        .append(<span class="java&#45;quote">&quot;,timeZone:&quot;</span>).append(m&#95;timeZone)&#10;        .append(<span class="java&#45;quote">&quot;,telephone:&quot;</span>).append(m&#95;telephone)&#10;        .append(<span class="java&#45;quote">&quot;,lastSuccessfulLogin:&quot;</span>).append(m&#95;lastSuccessfulLogin)&#10;        .append(<span class="java&#45;quote">&quot;,lastSuccessfulLoginIp:&quot;</span>).append(m&#95;lastSuccessfulLoginIp)&#10;        .append(<span class="java&#45;quote">&quot;,lastFailedLogin:&quot;</span>).append(m&#95;lastFailedLogin)&#10;        .append(<span class="java&#45;quote">&quot;,lastFailedLoginIp:&quot;</span>).append(m&#95;lastFailedLoginIp)&#10;        .append(<span class="java&#45;quote">&quot;,loginFailureCount:&quot;</span>).append(m&#95;loginFailureCount)&#10;        .append(<span class="java&#45;quote">&quot;,maxLoginFailureCount:&quot;</span>).append(m&#95;maxLoginFailureCount)&#10;        .append(<span class="java&#45;quote">&quot;,resetLockedOutAfterTime:&quot;</span>).append(m&#95;resetLockedOutAfterTime)&#10;        .append(<span class="java&#45;quote">&quot;,resetLockedOutTime:&quot;</span>).append(m&#95;resetLockedOutTime)&#10;        .append(<span class="java&#45;quote">&quot;,lockedOut:&quot;</span>).append(m&#95;lockedOut)&#10;        .append(<span class="java&#45;quote">&quot;,disabled:&quot;</span>).append(m&#95;disabled)&#10;        .append(<span class="java&#45;quote">&quot;,isSuperUser:&quot;</span>).append(m&#95;isSuperUser)&#10;        .append(<span class="java&#45;quote">&quot;,passwordNeverExpires:&quot;</span>).append(m&#95;passwordNeverExpires)&#10;        .append(<span class="java&#45;quote">&quot;,passwordChangeDate:&quot;</span>).append(m&#95;passwordChangeDate)&#10;        .append(<span class="java&#45;quote">&quot;,privs:&quot;</span>).append(m&#95;privileges);&#10;        <span class="java&#45;keyword">return</span> sb.toString();&#10;    &#125;&#10;&#10;    /&#42;&#42;&#10;     &#42; Copies editable data from <span class="java&#45;keyword">this</span> object to User object provided.  This is used&#10;     &#42; in Edit actions.  Not all fields are copied, only those that are editable&#10;     &#42; &#64;param user <span class="java&#45;object">Object</span> to copy to&#10;     &#42;/&#10;    <span class="java&#45;keyword">public</span> void copy(User user) &#123;&#10;        user.setUsername(m&#95;username);&#10;        user.setEmail(m&#95;email);&#10;        user.setLocale(m&#95;locale);&#10;        user.setTimeZone(m&#95;timeZone);&#10;        user.setTelephone(m&#95;telephone);&#10;        user.setLockedOut(m&#95;lockedOut);&#10;        user.setDisabled(m&#95;disabled);&#10;        user.setPasswordNeverExpires(m&#95;passwordNeverExpires);&#10;&#10;        <span class="java&#45;comment">// <span class="java&#45;keyword">do</span> some smarts <span class="java&#45;keyword">for</span> privs removal.  Clear all <span class="java&#45;keyword">if</span> more than half are removed</span>&#10;        <span class="java&#45;keyword">if</span> (m&#95;privileges.size() &lt;= user.getPrivileges().size() / 2) &#123;&#10;            LOG.debug(<span class="java&#45;quote">&quot;detected that many privs are removed, clearing all&quot;</span>);&#10;            user.setPrivileges(m&#95;privileges);&#10;        &#125; <span class="java&#45;keyword">else</span> &#123;&#10;            <span class="java&#45;comment">// find which ones should be removed</span>&#10;            List toRemove = <span class="java&#45;keyword">new</span> ArrayList();&#10;            <span class="java&#45;keyword">for</span> (Iterator i = user.getPrivileges().iterator(); i.hasNext(); ) &#123;&#10;                <span class="java&#45;object">String</span> priv = (<span class="java&#45;object">String</span>)i.next();&#10;                <span class="java&#45;keyword">if</span> (&#33;m&#95;privileges.contains(priv)) &#123;&#10;                    toRemove.add(priv);&#10;                &#125;&#10;            &#125;&#10;&#10;            <span class="java&#45;comment">// remove them</span>&#10;            <span class="java&#45;keyword">for</span> (<span class="java&#45;object">int</span> i = 0; i &lt; toRemove.size(); i&#43;&#43;) &#123;&#10;                user.getPrivileges().remove(toRemove.get&#40;&#105;&#41;);&#10;            &#125;&#10;&#10;            <span class="java&#45;comment">// add all <span class="java&#45;keyword">new</span> privs</span>&#10;            <span class="java&#45;keyword">for</span> (Iterator i = m&#95;privileges.iterator(); i.hasNext(); ) &#123;&#10;                user.getPrivileges().add(i.next());&#10;            &#125;&#10;        &#125;&#10;    &#125;&#10;&#125;</pre>
</div></div>

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="border/border_bottom.gif"><img src="border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Dec 14, 2004 16:36</font></td>
		    </tr>
	    </table>
    </body>
</html>